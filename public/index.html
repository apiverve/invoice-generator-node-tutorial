<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Generator | APIVerve Tutorial</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      padding: 40px 20px;
      color: #e0e0e0;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #00d4aa, #00b4d8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: #888;
      font-size: 1.1rem;
    }

    .invoice-form {
      background: #1e1e2e;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .form-section {
      margin-bottom: 32px;
    }

    .form-section h2 {
      font-size: 1.1rem;
      color: #00d4aa;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid #2a2a3e;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    @media (max-width: 600px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      font-size: 0.85rem;
      color: #888;
      margin-bottom: 6px;
    }

    input, textarea {
      padding: 12px;
      border: 1px solid #2a2a3e;
      border-radius: 8px;
      background: #16162a;
      color: #e0e0e0;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #00d4aa;
    }

    /* Items Section */
    .items-list {
      margin-bottom: 16px;
    }

    .item-row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr auto;
      gap: 12px;
      margin-bottom: 12px;
      align-items: end;
    }

    @media (max-width: 600px) {
      .item-row {
        grid-template-columns: 1fr;
      }
    }

    .remove-btn {
      padding: 12px 16px;
      background: #ef4444;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }

    .remove-btn:hover {
      background: #dc2626;
    }

    .add-item-btn {
      padding: 12px 20px;
      background: transparent;
      border: 1px dashed #2a2a3e;
      border-radius: 8px;
      color: #00d4aa;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s;
    }

    .add-item-btn:hover {
      border-color: #00d4aa;
      background: rgba(0, 212, 170, 0.1);
    }

    /* Generate Button */
    .generate-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #00d4aa, #00b4d8);
      border: none;
      border-radius: 12px;
      color: #1a1a2e;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .generate-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 212, 170, 0.4);
    }

    .generate-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Result */
    .result {
      margin-top: 24px;
      padding: 20px;
      background: rgba(0, 212, 170, 0.1);
      border: 1px solid rgba(0, 212, 170, 0.3);
      border-radius: 12px;
      text-align: center;
      display: none;
    }

    .result.show {
      display: block;
    }

    .result h3 {
      color: #00d4aa;
      margin-bottom: 12px;
    }

    .download-btn {
      display: inline-block;
      padding: 12px 24px;
      background: #00d4aa;
      color: #1a1a2e;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      transition: background 0.2s;
    }

    .download-btn:hover {
      background: #00b4d8;
    }

    .error {
      margin-top: 16px;
      padding: 12px;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 8px;
      color: #f87171;
      display: none;
    }

    .error.show {
      display: block;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      color: #666;
      font-size: 0.9rem;
    }

    footer a {
      color: #00d4aa;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Invoice Generator</h1>
      <p class="subtitle">Create professional PDF invoices instantly</p>
    </header>

    <div class="invoice-form">
      <!-- Invoice Details -->
      <div class="form-section">
        <h2>Invoice Details</h2>
        <div class="form-grid">
          <div class="form-group">
            <label>Invoice Number</label>
            <input type="text" id="invoiceNumber" value="INV-001" required>
          </div>
          <div class="form-group">
            <label>Invoice Date</label>
            <input type="date" id="invoiceDate" required>
          </div>
          <div class="form-group">
            <label>Due Date</label>
            <input type="date" id="dueDate" required>
          </div>
          <div class="form-group">
            <label>Currency</label>
            <input type="text" id="currency" value="USD">
          </div>
        </div>
      </div>

      <!-- From (Your Company) -->
      <div class="form-section">
        <h2>From (Your Company)</h2>
        <div class="form-grid">
          <div class="form-group">
            <label>Company Name</label>
            <input type="text" id="fromName" placeholder="Your Company Inc." required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="fromEmail" placeholder="billing@company.com">
          </div>
          <div class="form-group full-width">
            <label>Address</label>
            <input type="text" id="fromAddress" placeholder="123 Business St, City, Country">
          </div>
        </div>
      </div>

      <!-- To (Client) -->
      <div class="form-section">
        <h2>To (Client)</h2>
        <div class="form-grid">
          <div class="form-group">
            <label>Client Name</label>
            <input type="text" id="toName" placeholder="Client Company" required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="toEmail" placeholder="client@example.com">
          </div>
          <div class="form-group full-width">
            <label>Address</label>
            <input type="text" id="toAddress" placeholder="456 Client Ave, City, Country">
          </div>
        </div>
      </div>

      <!-- Line Items -->
      <div class="form-section">
        <h2>Line Items</h2>
        <div class="items-list" id="itemsList">
          <div class="item-row">
            <div class="form-group">
              <label>Description</label>
              <input type="text" class="item-desc" placeholder="Service or product" required>
            </div>
            <div class="form-group">
              <label>Quantity</label>
              <input type="number" class="item-qty" value="1" min="1" required>
            </div>
            <div class="form-group">
              <label>Unit Price</label>
              <input type="number" class="item-price" placeholder="0.00" step="0.01" required>
            </div>
            <button type="button" class="remove-btn" onclick="removeItem(this)">×</button>
          </div>
        </div>
        <button type="button" class="add-item-btn" onclick="addItem()">+ Add Item</button>
      </div>

      <!-- Notes -->
      <div class="form-section">
        <h2>Notes (Optional)</h2>
        <div class="form-group">
          <textarea id="notes" rows="3" placeholder="Payment terms, thank you message, etc."></textarea>
        </div>
      </div>

      <button class="generate-btn" id="generateBtn" onclick="generateInvoice()">
        Generate Invoice PDF
      </button>

      <div class="error" id="error"></div>

      <div class="result" id="result">
        <h3>Invoice Generated!</h3>
        <a href="#" class="download-btn" id="downloadBtn" target="_blank">Download PDF</a>
      </div>
    </div>

    <footer>
      <p>
        Powered by
        <a href="https://apiverve.com/marketplace/invoicegenerator?utm_source=github&utm_medium=tutorial&utm_campaign=invoice-generator-node-tutorial"
           target="_blank">
          APIVerve Invoice Generator API
        </a>
      </p>
    </footer>
  </div>

  <script>
    // Set default dates
    const today = new Date().toISOString().split('T')[0];
    const dueDate = new Date();
    dueDate.setDate(dueDate.getDate() + 30);
    document.getElementById('invoiceDate').value = today;
    document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];

    // Add new line item
    function addItem() {
      const itemsList = document.getElementById('itemsList');
      const newRow = document.createElement('div');
      newRow.className = 'item-row';
      newRow.innerHTML = `
        <div class="form-group">
          <label>Description</label>
          <input type="text" class="item-desc" placeholder="Service or product" required>
        </div>
        <div class="form-group">
          <label>Quantity</label>
          <input type="number" class="item-qty" value="1" min="1" required>
        </div>
        <div class="form-group">
          <label>Unit Price</label>
          <input type="number" class="item-price" placeholder="0.00" step="0.01" required>
        </div>
        <button type="button" class="remove-btn" onclick="removeItem(this)">×</button>
      `;
      itemsList.appendChild(newRow);
    }

    // Remove line item
    function removeItem(btn) {
      const rows = document.querySelectorAll('.item-row');
      if (rows.length > 1) {
        btn.closest('.item-row').remove();
      }
    }

    // Generate invoice
    async function generateInvoice() {
      const btn = document.getElementById('generateBtn');
      const error = document.getElementById('error');
      const result = document.getElementById('result');

      // Collect line items
      const items = [];
      document.querySelectorAll('.item-row').forEach(row => {
        const desc = row.querySelector('.item-desc').value;
        const qty = parseFloat(row.querySelector('.item-qty').value) || 1;
        const price = parseFloat(row.querySelector('.item-price').value) || 0;

        if (desc && price > 0) {
          items.push({
            description: desc,
            quantity: qty,
            unitPrice: price,
            amount: qty * price
          });
        }
      });

      if (items.length === 0) {
        error.textContent = 'Please add at least one line item';
        error.classList.add('show');
        return;
      }

      // Build invoice data
      const invoiceData = {
        invoiceNumber: document.getElementById('invoiceNumber').value,
        invoiceDate: document.getElementById('invoiceDate').value,
        dueDate: document.getElementById('dueDate').value,
        currency: document.getElementById('currency').value || 'USD',
        from: {
          name: document.getElementById('fromName').value,
          email: document.getElementById('fromEmail').value,
          address: document.getElementById('fromAddress').value
        },
        to: {
          name: document.getElementById('toName').value,
          email: document.getElementById('toEmail').value,
          address: document.getElementById('toAddress').value
        },
        items: items,
        notes: document.getElementById('notes').value
      };

      btn.disabled = true;
      btn.textContent = 'Generating...';
      error.classList.remove('show');
      result.classList.remove('show');

      try {
        const response = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(invoiceData)
        });

        const data = await response.json();

        if (data.success && data.pdfUrl) {
          document.getElementById('downloadBtn').href = data.pdfUrl;
          result.classList.add('show');
        } else {
          error.textContent = data.error || 'Failed to generate invoice';
          error.classList.add('show');
        }
      } catch (err) {
        error.textContent = 'Failed to connect to server';
        error.classList.add('show');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Generate Invoice PDF';
      }
    }
  </script>
</body>
</html>
